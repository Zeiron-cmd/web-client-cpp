events {}

http {
    upstream web_client {
        server web:8080;
        keepalive 32;
    }

    server {
        listen 80;

        # Чтобы nginx корректно проксировал любые пути
        location / {
            proxy_pass http://web_client;

            # Нормальные заголовки прокси
            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-Host $host;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

            # WebSocket / keep-alive (не обязательно, но полезно)
            proxy_http_version 1.1;
            proxy_set_header Connection "";
            proxy_set_header Upgrade $http_upgrade;

            # Cookie можно не указывать (nginx и так передаёт),
            # но пусть будет явно — не мешает
            proxy_set_header Cookie $http_cookie;
        }
    }
}
